%============================================================
% PHY2027 Assessment 3 – Final Project Report
% Option 3: 2D Ising Model Simulation
%============================================================
\documentclass[10pt,a4paper]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\usepackage{caption,subcaption}
\usepackage{booktabs}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{fancyhdr}
\usepackage{inconsolata}
\usepackage[hidelinks]{hyperref}

% Code listing style
\lstset{
    language=C,
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{gray},
    numbers=left,
    numbersep=8pt,
    frame=single,
    captionpos=b,
    breaklines=true
}

% Header/Footer
\pagestyle{fancy}
\fancyhf{}
\rhead{PHY2027 – Ising Model Report}
\lhead{Miguel de Sousa}
\cfoot{\thepage}

\title{Two-Dimensional Ising Model Simulation\\
       \large PHY2027 – Scientific Programming in C – Final Project Report}
\author{Miguel de Sousa}
\date{\today}

\begin{document}

\maketitle

\section{Theory}
[1] The Ising model, introduced by Ernst Ising in 1925, is a mathematical model consisting of a lattice of 'spin' variables $\sigma_\alpha$ which can take discrete values of $\pm1$.
These spins represent magnetic dipole moments of atomic spins that can be in one of two states: up (+1) or down (-1). The model is used to study phase transitions and critical phenomena in statistical mechanics.
[1]Any two of these spins have a mutual interaction Energy
\begin{equation}
    -E_{\alpha\beta}\sigma_\alpha\sigma_\beta
\end{equation}

[1]Additionally, an external magnetic field $B$ can interact with each spin, contributing an energy term of
\begin{equation}
    -B\sigma_\alpha
\end{equation}

The total energy of a configuration of spins on a lattice can be expressed as
\begin{equation}
    E = -\sum_{\langle \alpha,\beta \rangle} E_{\alpha\beta}\sigma_\alpha\sigma_\beta - B\sum_{\alpha} \sigma_\alpha
\end{equation}
where the first sum is over all pairs of neighbouring spins.
The Ising model exhibits a phase transition at a critical temperature $T_c$, below which the spins tend to align, resulting in spontaneous magnetisation, and above which the spins are disordered.

\section{Implementation}
\subsection{Data Structure and Initialisation (Part a)}
I began by defining a structure type to represent the 2D Ising lattice, which included all necessary parameters as structure members for the model such as its N-dimenionsionality, values for temperature T, external magnetic field B, total energy and magnetisation of the lattice, and a pointer to an array of spins.

Lines 18-20: Assigning a char type to Spin, with constants for SPIN\_UP and SPIN\_DOWN defined with this new type. 
The char data type forces each spin to occupy only 1 byte of memory, which is efficient for large n by n lattices. 
The Spin type is used throughout the code, so defining it at the start improves code readability.\medbreak

Lines 22-30: Creating the IsingLattice structure type with members for lattice size N, pointer to spin array, temperature T, external magnetic field B, current step number, total energy, and total magnetisation.
Structures are useful for grouping related data together, so its perfect for representing the lattice and its properties.
I used double for T, B, energy, and magnetisation to allow for fractional values and higher precision in calculations.
The step member is an unsigned long long to allow a large number of Monte Carlo steps.
Proving its reuseability, the spin pointer defined in the sructure types is allocatd to my new Spin data type.\medbreak

After defining the structure type, I implemented the initialisation function to set up the lattice with random n by n spins.

Lines 145-150: The create\_function takes lattice parameters as arguments and it allocates enough memory for the new lattice instance using malloc
and the size of the IsingLattice structure type.
It checks if the allocation was successful, printing an error message and exiting if not.
The structure type pointer is initalised within the fucntion as *lattice.\medbreak

Lines 152-158: Assign the input parameters to the corresponding structure members in the IsingLattice using structure pointer notation.\medbreak

Lines 160-164/169-178: Allocate memory for the spin array within the lattice structure using malloc.
The size is n by n multiplied by the size of a char (1 byte) since each spin is represented as a char.
It checks for successful allocation, freeing the previously allocated lattice memory location if the spin allocation fails.
I then assigned each lattice spin array value in the lattice to a random value of SPIN\_UP or SPIN\_DOWN using a count controlled loop with boundaries at 0 and n by n.
The rand() function acted as the randomiser, with modulus 2 giving eitehr values of 0 or 1, which were mapped to either SPIN\_UP or SPIN\_DOWN. The energy and magnetisation
values where also initialised using the ebergy and magnetisation functions\medbreak

Lines 166: Finally, the function returns a pointer to the newly created and initialised lattice instance.


\subsection{Energy and Magnetisation Calculation (Part a)}
I proceeded to create a total energy function for my ising model using the hamiltonian
research stated in the theory section. The ising\_hamiltonian takes the N value of the lattice
and also initialises a local variable energy with a double type to store all energy components.

Lines 184-186: The code uses nested for loops to iterate through every spin in the lattice, the first iterating through rows and the second through columns.
The s value assigned the new datatype Spin, retreives the current spin values for the lattice as a one dimensional representation of the two dimensions lattice.

Lines 188-194: I iterate through every spin value ($\delta$) in the lattice and sum the energy contribution from the two possible sources: the nearest-neighbor interactions and the external magnetic field (B), if present.
This task was made efficient by the initial mapping of the two-dimensional lattice onto a single one-dimensional array. This mapping allows for fast index lookups and ensures efficiency during the summation loop.
Each value was added onto the double value created earlier and the energy returned from the function.

Once the total energy function was created, I began working on the function to output normalised values of magnetisation.



\subsection{Metropolis Algorithm (Part b)}
The metropolis algorithm is the main function governing the evolution of the system.
it decides whether a randomly chosen spin is likely to flip state based on probablity.

Lines 222-224: Using rand(), random i and j locations can be chosen to pinpoint a spin vaue within the lattice in an unbiased fashion.

Lines 226: Instead of calculating total energy again, I used the chosen spin location and the chnage in energy function
to figure out the energy chnage if the spin flip did occur.

Lines 228-241: If the energy chnage is less than 0 for the spin then the energy chnage will awlays be favourable and you can flip that particular lattice spin and return 1.
Nothing is accepted at absolute zero temperature therfore than can be ignored as an option.
This leaves the intresting part of the flip probability, energy levels greater than 0. 
In this case it follows a boltzmann factor whose value is stored in a double.
Using the rand function again, I created a randomised r value for each iteration of this algorithm,
when r is less than the acceptance probability (boltzmann factor) then the lattice energy flip is succesful.



\subsection{Visualisation Method (Part c)}
For my simulation, I decided to take guided user inputs using switch cases for standard ising states.
The program will start by giving users flexibility with choices.

Lines 40-115: The user is prompted with multiple input choices for N, T and B values.
These are selected as standard values you would use to extract information from thes imualtion such as tenpearture being broken down
into Low, Critical and High options to view the possible extreme states of the ising simulation. These inputs are all sanitised, checking if the users did in fact only input one value. Furthermore,
default case denies any value that doesnt sit with the required format. Users also have a custom choice.
To avoid datatype issues, a temporary integer CASE was created to handle all users selections as using varaibles such as T with double is not valid for these cases.

Lines 117-143: The program checks for a valid proceed option.
If true, a new instance of an Ising Lattice is created with previously selcted N, T and B values.
After the Lattice has been initalised the main simulation flow can begin, I create a loop defining the Monte Carlo Steps of the program (simulation time),
with the inner loop iterating through every lattice value. Each step in the Monte Carlo acts as a sweep of the lattice where every spin experineces a possible flip change 
caused by the metropolis algorithm. Each step is updated directly on the lattice and snapshots are taken in increments of 200 steps until the program loop finishes.
All information being passed on to the python program is handled by the write\_csv function.

Lines 244--274: The write\_csv first checks for the successful opening of the 
ising\_data csv file before proceeding.
The function takes all values of the ising lattice, including a nested loop sweep of the lattice spin values and writes them to
a single csv file. This includes updated magnetisation, energy spin flip values.

134-137: Once the simulation csv is complete, the user is notified and the lattice is freed from memory.

\section{Program Exploration and Results}
\subsection{Temperature Effect with Zero External Field ($B=0$)}
\subsubsection{Low Temperature $\approx 1.5Jk_B^{-1}$}

\href{https://github.com/Miguel-De-Sousa/ising_model/blob/main/data/ising_evolution_low.gif}
{\textbf{View Ising Low-Temperature Simulation (Online)}}
\label{fig:ising_evolution_low_online}

At a temperature of 1.5, the Ising model simulation is below its critical temperature and therefore lies within the ferromagnetic phase.
In this phase, the spins tend to align in the same direction, resulting in a net magnetic moment.
As the simulation progresses, we see the formtaion of large domains of aligned spins, leading to a normalised magnetisation approaching 1.
Thermal fluctuations are minimal at this low temperature, so the spins remain mostly stable once they align.

\subsubsection{Critical Temperature $\approx 2.269Jk_B^{-1}$}

\href{https://github.com/Miguel-De-Sousa/ising_model/blob/main/data/ising_evolution_critical.gif}
{\textbf{View Ising Critical-Temperature Simulation (Online)}}
\label{fig:ising_evolution_critical_online}

At the critical temperature of approximately 2.269, the Ising model undergoes a phase transition from the ferromagnetic to the paramagnetic phase.
In this sumulation, we see many fluctuations in spin alignement as the system has high sensitivity to thermal energy.
Large clusters or domains of aligned spins form and disintegrate frequently, leading to a normalised magnetisation that hovers around zero.
This is a characteristic behavior at the critical point, which remains the same even if the simulation is scaled up to larger lattice sizes.

\subsubsection{High Temperature $\approx 7.5Jk_B^{-1}$}

\href{https://github.com/Miguel-De-Sousa/ising_model/blob/main/data/ising_evolution_high.gif}
{\textbf{View Ising High-Temperature Simulation (Online)}}
\label{fig:ising_evolution_high_online}

At a high temperature of 7.5, the Ising model is well above its critical temperature and remains in the paramagnetic phase.
In this phase, thermal fluctuations dominate, causing the spins to be orientated randomly with no possibility for order.
As the simulation runs, we can see that the spins to not form any significant clusters resulting in a normalised magnetisation that stays close to zero.
This high temperature causes a disordered state for the remaining duration of the simulation.

\subsection{Effect of External Magnetic Field ($B \neq 0$)}

\href{https://github.com/Miguel-De-Sousa/ising_model/blob/main/data/ising_evolution_field.gif}
{\textbf{View Ising Simulation with $\beta$ field(Online)}}
\label{fig:ising_evolution_field_online}

\subsection{Boundary and Neighbour Effects}

\section{Conclusion}

\begin{thebibliography}{1}
\bibitem{mccoy2014}
B.~M.~McCoy and T.~T.~Wu, \textit{The Two-Dimensional Ising Model}, Harvard University Press, Reprint 2014.
\end{thebibliography}

\end{document}